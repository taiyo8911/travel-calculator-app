# トラベルマネージャー (Travel Manager App)
海外旅行時の両替記録と買い物記録を管理し、レートや支出金額を日本円で把握できる旅行用現金特化管理アプリ

## 主な機能

### 旅行管理
* 複数の旅行を作成・管理
* 旅行ごとに通貨を設定（18種類の通貨に対応）
* 旅行期間の設定と日数の自動計算
* 旅行のステータス表示（現在旅行中/予定/終了）
* 旅行情報の編集機能（通貨以外の編集が可能）
* 旅行記録のPDF出力・共有機能
* モダンなカスタムヘッダーデザイン（グラデーション背景）
* 旅行統計情報の表示（総旅行数、進行中の旅行、予定の旅行）

### 両替記録
* **4つの入力方式に対応**：
  - 従来方式（1外貨=○円）
  - 両替所表示方式（○円=○外貨）
  - 1円あたり方式（1円=○外貨）
  - 1外貨あたり方式（1外貨=○円）
* 両替した日本円と受け取った外貨の記録
* 両替所の表示レートと実質レートの計算
* 手数料率の自動計算と高手数料（3%以上）の警告表示
* 両替記録の一覧表示、追加、編集、削除
* 国旗絵文字による通貨の視覚的表示
* 入力方式別の統計と内訳表示
* データバージョン管理と自動移行機能

### 買い物記録
* 外貨での支出記録
* 買い物内容の説明記録
* 加重平均レートを使った日本円換算額の計算
* 買い物記録の一覧表示、追加、編集、削除
* 両替記録がない場合の入力制限と警告表示

### 集計・分析機能
* 旅行全体の両替総額（円・外貨）
* 加重平均レートの自動計算
* 買い物総額（外貨・日本円換算）
* 残り外貨の計算と日本円換算
* 最高・最低両替レート分析
* 最高・最低支出額分析
* 入力方式別の使用状況分析
* リアルタイム計算とプレビュー表示

### PDF出力機能
旅行記録をPDFで出力・共有できる機能を搭載。

#### 1ページ目：両替情報
* 旅行の基本情報（名称、期間、通貨）
* 両替サマリー（総額、取得外貨、回数、平均レート）
* 両替分析（最高・最低レート、入力方式内訳）
* 両替履歴詳細テーブル

#### 2ページ目：支出情報
* 支出サマリー（外貨総額、円換算総額、回数）
* 支出分析（最高・最低支出、残り外貨）
* 買い物履歴詳細テーブル

## UI/UX設計

### デザイン特徴
* NavigationStackベースのモダンなナビゲーション（iOS 16対応）
* カード形式での直感的な操作
* サマリーカードによる重要情報の可視化
* ダークモード対応
* アクセシビリティ対応（DynamicTypeSize制限付き）
* 視覚的フィードバック（警告表示、ステータスバッジ、色分け）

### 操作性
* コンテキストメニューによる編集・削除操作
* スワイプ削除対応
* リアルタイム計算とプレビュー表示
* 入力値バリデーションと詳細エラーメッセージ
* 空状態の適切な案内表示

## データ管理

### 永続化
* ローカルデータの永続化（UserDefaults使用）
* JSONエンコード/デコードによるデータ保存
* データバージョン管理（現在v1.1.0）
* 自動データ移行機能

### データ整合性
* 包括的な入力バリデーション
* データ修復機能
* 既存データとの後方互換性維持
* 設定画面でのデータリセット機能

## 対応通貨一覧（18種類）

### 北米・南米
* 米ドル (USD)
* カナダドル (CAD)
* メキシコペソ (MXN)

### ヨーロッパ
* ユーロ (EUR)
* 英ポンド (GBP)
* スイスフラン (CHF)

### 東アジア
* 中国元 (CNY)
* 香港ドル (HKD)
* 台湾ドル (TWD)
* 韓国ウォン (KRW)

### 東南アジア
* タイバーツ (THB)
* シンガポールドル (SGD)
* マレーシアリンギット (MYR)
* インドネシアルピア (IDR)
* ベトナムドン (VND)
* フィリピンペソ (PHP)

### オセアニア
* 豪ドル (AUD)
* NZドル (NZD)

## 主要機能の計算ロジック

### 加重平均レート計算
```
加重平均レート = 総両替円額 ÷ 総取得外貨額
```

### 手数料計算
```
実質レート = 両替円額 ÷ 取得外貨額
手数料率 = ((実質レート - 表示レート) ÷ 表示レート) × 100
高手数料判定 = 手数料率 > 3.0%
```

### 日本円換算
```
買い物の円換算額 = 外貨支出額 × 加重平均レート
```

### レート入力方式変換
* **両替所表示**: `value1円 = value2外貨` → `1外貨 = value1/value2 円`
* **1円あたり**: `1円 = value1外貨` → `1外貨 = 1/value1 円`
* **1外貨あたり**: `1外貨 = value1円` → そのまま使用

## アプリ構成

### アーキテクチャ
MVVMアーキテクチャに基づいて設計され、SwiftUIを使用して構築

### 使用技術
* **言語**: Swift 5.9+
* **フレームワーク**: SwiftUI 4.0+
* **アーキテクチャ**: MVVM（Model-View-ViewModel）
* **最低動作環境**: iOS 16.6以上
* **対応デバイス**: iPhone

### 主要な実装特徴
* **リアルタイム計算**: 入力中にリアルタイムで手数料や換算額を表示
* **データ整合性**: 両替記録がない場合の適切な警告表示と入力制限
* **視覚的フィードバック**: 国旗絵文字、色分け警告、ステータスバッジ
* **直感的操作**: コンテキストメニュー、スワイプ削除、ワンタップ遷移
* **完全オフライン**: インターネット接続不要で全機能利用可能
* **バリデーション**: 通貨別制限値と詳細エラーメッセージ

## ファイル構成

```
TravelCalculator/
├── TravelCalculatorApp.swift          // アプリのエントリーポイント
│
├── Models/
│   ├── Trip.swift                     // 旅行モデル
│   ├── Currency.swift                 // 通貨モデル
│   ├── ExchangeRecord.swift           // 両替記録モデル（4つの入力方式対応）
│   └── PurchaseRecord.swift           // 買い物記録モデル
│
├── ViewModels/
│   └── TravelCalculatorViewModel.swift // メインビューモデル
│
├── Views/
│   ├── ContentView.swift              // メインコンテンツビュー
│   │
│   ├── Trips/
│   │   ├── TripListView.swift         // 旅行一覧画面（カスタムヘッダー付き）
│   │   ├── AddTripView.swift          // 旅行追加画面
│   │   ├── EditTripView.swift         // 旅行編集画面
│   │   └── TripDetailView.swift       // 旅行詳細画面
│   │
│   ├── Exchange/
│   │   ├── ExchangeListView.swift     // 両替履歴画面（統計表示付き）
│   │   ├── AddExchangeView.swift      // 両替追加画面（多方式入力対応）
│   │   └── EditExchangeView.swift     // 両替編集画面（移行機能付き）
│   │
│   ├── Purchase/
│   │   ├── PurchaseListView.swift     // 買い物履歴画面
│   │   ├── AddPurchaseView.swift      // 買い物追加画面
│   │   └── EditPurchaseView.swift     // 買い物編集画面
│   │
│   ├── Componets/
│   │   ├── SummaryCard.swift          // 集計カードコンポーネント
│   │   ├── ExchangeCard.swift         // 両替カードコンポーネント（入力方式表示）
│   │   └── PurchaseCard.swift         // 買い物カードコンポーネント
│   │
│   └── Settings/
│       └── SettingsView.swift         // 設定画面
│
├── Utilities/
│   ├── CurrencyFormatter.swift        // 通貨フォーマッタ
│   ├── FlagEmoji.swift                // 国旗絵文字ユーティリティ
│   ├── PDFGenerator.swift             // PDF生成ユーティリティ
│   ├── RateCalculationUtility.swift   // レート計算・バリデーションユーティリティ
│   └── ValidationConstants.swift      // バリデーション定数・制限値
│
├── Assets.xcassets/                   // アプリアイコン・カラーセット
├── Preview Content/
│   └── Preview Assets.xcassets/       // プレビュー用アセット
├── Info.plist                         // アプリ設定
└── TravelCalculator.entitlements      // アプリ権限設定
```

## バリデーション・制限値

### 金額制限
* **日本円**: 1円 〜 1億円
* **外貨**: 通貨別に最適化された制限値
  - USD, EUR等: 0.01 〜 100万単位
  - KRW, IDR, VND: 1 〜 より大きな単位（整数のみ）

### レート制限
* **最小レート**: 0.001円（0.1銭）
* **最大レート**: 10,000円
* **両替所表示**: 1円 〜 10万円の範囲

### 文字列制限
* **旅行名**: 50文字以内
* **国名**: 30文字以内
* **買い物説明**: 100文字以内

## データ移行・バージョン管理

### 現在のデータバージョン: 1.1.0

### 移行内容
* **v1.0.x → v1.1.x**: 既存の両替記録にレート入力方式情報を追加
* 後方互換性を維持しながら新機能を追加
* 自動修復機能による不正データの検出・修正

## 操作フロー

1. **旅行作成**: 旅行リスト画面から新規旅行を作成
2. **両替記録**: 旅行詳細画面で4つの入力方式から選択して両替情報を登録
3. **買い物記録**: 外貨での支出を記録（自動円換算）
4. **データ分析**: リアルタイムでレートや支出状況を確認
5. **記録保存**: 旅行終了後はPDF出力で記録を保存・共有

## 技術的特徴

### iOS 16対応
* NavigationStack使用による最新のナビゲーション実装
* 最新のSwiftUI機能を活用
* Dynamic Type対応によるアクセシビリティ向上

### パフォーマンス
* 効率的なデータ構造設計
* リアルタイム計算の最適化
* メモリ効率的なビュー更新

### 保守性
* MVVM設計による責任分離
* 再利用可能なコンポーネント設計
* 包括的なユーティリティクラス
* 詳細なバリデーション機能
